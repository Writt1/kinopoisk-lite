# Учебный проект Кинопоиск Lite на PHP и ООП

Этот проект был основан на [видеоуроке](https://youtu.be/MwtEjIpqIKQ?si=8vQJaQ1YMDqvDAz2) канала AreaWeb.

Я использовала знания полученные при просмотре видеоурока как основу для небольшего расширения этого проекта. Все мои изменения объединены с оригинальным репозиторием автора — теперь проект содержит оригинальные файлы и мои доработки. 


### Были добавлены дальнейшие изменения и функционал:

- Страница `/best`(pages/best.php) для отображения всех фильмов из базы с рейтингом не ниже определенного значения (сейчас я установила 8.5).
- Страница `/categories`(pages/categories/index.php), для отображения всех жанров и количества фильмов каждого жанра.
- При нажатии на каждый жанр вас перенаправит на страницу `/categories/category`(pages/categories/category.php), где будут показаны все фильмы этого жанра.

- Добавлен новый сервис ReviewService для работы с отзывами из бд.
- Изменен ReviewController, теперь работа с базой происходит через ReviewService.
  
- Добавлен новый мидлвар AdminMiddleware, теперь при попытке доступа к админке обычными пользователями и не авторизованнымми они перенаправляются на страницу главное (админы это пользователи в таблице `users`, у которых в столбце is_admin стоит 1, это нужно изменять в ручную в базе после регистрации пользователя). 
  
- В контроллере CategoryController были изменены некоторые методы и добавлен метод show().
- В контроллере MovieController были также изменены некоторые методы и добавлены методы home() и best().
- Дополнен метод register() в RegisterController, теперь когда пользователь регестрируется и добавляется в базу, он автоматически авторизируется.

- В CategoryService добавлен метод findMovies().
- В MovieService добавлен метод best().

- В модель Category добавлено приватное свойство $moviesCount и геттер с сеттером для него.
- В модель Review добавлено приватное свойство $movie и геттер для него.

- В Database был добавлен новый метод topRated().
- В User был добавлен геттер isAdmin().

- На страницах `/login` и `register` были добавлены ссылки на друг друга и немного изменено отображение этих страниц.


Также, так как изначальный код писался с нуля в процессе просмотра видео, то, я заметила, что в изменениях в файлах тут много где просто дополнительные пробелы, отсутствие ненужных запятых или измененные названия методов/свойств и т. д.



### Запуск

Для работы приложения необходимо установить зависимости используя Composer.

```shell
composer install
```

Для запуска проекта используется Docker Compose.

```shell
docker-compose up -d
```


### Конфигурация

За конфигурацию приложения отвечают файлы, которые находятся в папке `config`.

- `app.php` - конфигурация приложения, в том числе хост
- `database.php` - конфигурация базы данных
- `auth.php` - конфигурация аутентификации пользователя

### База данных

Для работы приложения необходимо импортировать в автоматически созданную бд `movie_db` дамп, который находится в папке `database`.
```shell
docker exec -i mysql4 mysql -u root -proot movie_db < database/dump.sql
```


### Файловая система

Для доступа к файлам, которые находятся в папке `storage`, необходимо создать символическую ссылку на папку `public/storage`.

#### Linux

```shell
ln -s $PWD/storage $PWD/public/storage
```

#### Windows

```shell
mklink /D storage public/storage
```
